# Minecraft Core Mechanics & World Generation Research

Comprehensive technical reference for cloning Minecraft mechanics in a voxel engine.

---

## 1. World Structure

### Chunk Format
- **Chunk dimensions**: 16x16 blocks horizontal, 384 blocks vertical (Y=-64 to Y=319) in Overworld; 256 blocks vertical in Nether/End
- **Sections**: Each chunk is divided into 16x16x16 block sections (24 sections for Overworld, 16 for Nether/End)
- **All sections** are present in storage, even if empty (filled with air)

### Block State Storage (Palette System)
- Each section stores up to 4,096 blocks (16^3)
- Uses a **palette-based compression** system:
  - The **palette** is a list of unique block states used in that section
  - Each block is stored as an index into the palette
  - Index bit-width = minimum bits to represent largest palette index (minimum 4 bits)
  - Indices are packed into an array of 64-bit integers (longs)
  - Indices do NOT span across long boundaries -- if next index doesn't fit, it starts at bit 0 of the next long
  - If only 1 block state exists in palette, no data array is needed (entire section is that block)
- Palette entries contain:
  - `Name`: block resource location (e.g., `minecraft:stone`)
  - `Properties`: optional block state properties (orientation, power level, etc.)

### Biome Storage
- Biomes stored in cells of **4x4x4 blocks** (64 entries per section)
- Uses same palette system as blocks, max palette size of 64

### Heightmaps
- Multiple heightmap arrays per chunk (WORLD_SURFACE, OCEAN_FLOOR, MOTION_BLOCKING, etc.)
- 256 values (one per column), packed at 9 bits per value in 37 longs

### NBT Root Structure
```
DataVersion, xPos, zPos, yPos, Status
sections[] -> { Y, block_states { palette[], data[] }, biomes { palette[], data[] } }
block_entities[], block_ticks[], fluid_ticks[]
Heightmaps, structures, InhabitedTime
```

### Entity Storage
- Since 1.17, entities are stored separately from terrain chunks in an `entities/` directory
- Block entities (chests, furnaces, etc.) remain in the chunk under `block_entities`

---

## 2. Terrain Generation

### Algorithm Overview
Minecraft uses **multi-octave gradient noise** (Perlin/Simplex) to generate terrain. The modern system (1.18+) uses a multi-noise approach with several key parameters.

### Noise Parameters for Terrain Height
Three fractal noise maps control terrain shape:

1. **Continentalness** -- controls land vs ocean distinction. High = inland, low = ocean
2. **Erosion** -- controls flat vs mountainous. High erosion = flat terrain
3. **Peaks & Valleys (PV)** -- creates peaks, valleys, fjords

These are combined via **spline functions** (curves) that map noise values to terrain height:
- High continentalness + low erosion + high PV = massive steep mountains
- High erosion = flat plains regardless of other values

### Biome-Only Parameters
Two additional noise parameters affect biome selection but NOT terrain shape:
- **Temperature** -- 5 levels: [-1.0,-0.45], [-0.45,-0.15], [-0.15,0.2], [0.2,0.55], [0.55,1.0]
- **Humidity (Vegetation)** -- 5 levels: [-1.0,-0.35], [-0.35,-0.1], [-0.1,0.1], [0.1,0.3], [0.3,1.0]

### 3D Density Function
The terrain is ultimately defined by a **3D density function**:
- Positive density = solid block (stone)
- Negative density = air (or water below sea level)
- The density function combines all noise parameters with vertical gradients

### Generation Order
1. Generate noise values for continentalness, erosion, PV, temperature, humidity, weirdness
2. Use spline functions to compute base terrain height
3. Apply 3D density noise for overhangs, floating islands, etc.
4. Determine biome from the 6-parameter multi-noise system
5. Apply surface rules (grass on top, dirt beneath, sand in deserts, etc.)
6. Generate caves (noise caves + carvers)
7. Place ores, structures, features (trees, flowers, etc.)

---

## 3. Biome System

### Multi-Noise Biome Source
Biomes are determined by **6 noise parameters** at each position:
1. Temperature
2. Humidity (vegetation)
3. Continentalness
4. Erosion
5. Weirdness (ridges)
6. Depth

### Selection Algorithm
- Each biome is defined as a **hypercube** (ranges for each of the 6 parameters)
- For any world position, the 6 noise values are computed
- The biome whose hypercube center is **closest** (in multi-dimensional space) is selected
- This is essentially nearest-neighbor in 6D parameter space

### Weirdness Parameter
- Values > 0 produce "weirder" biome variants
- Controls variant selection (e.g., stony peaks vs jagged peaks)

---

## 4. Cave Generation

### Noise Caves (1.18+)
Three types of noise caves, all generated using 3D Perlin noise:

#### Cheese Caves
- Large, open pocket areas of varying sizes
- Generated by taking 3D noise and treating high values as air
- The noise image resembles cheese with holes
- Largest cave type in the game

#### Spaghetti Caves
- Long, narrow winding tunnels
- Generated at the boundary between high and low noise values
- Creates the classic tunnel-like passages

#### Noodle Caves
- Thinner variant of spaghetti caves (1-5 blocks wide)
- More squiggly and irregular

### Noise Cave Control Parameters
Each cave type is controlled by three noise maps:
- **Frequency** -- how often caves appear
- **Hollowness** -- how open the caves are
- **Thickness** -- wall thickness

### Aquifers
- Control water/lava placement in caves
- Generate underground liquid bodies (lakes)
- Create water/lava waterfalls
- Almost all liquids in the world (caves, rivers, oceans) are generated by aquifers

### Legacy Carver Caves
- Still present alongside noise caves
- "Perlin worms" -- cylindrical tunnels carved through terrain
- Start from a random point and wind through the world
- Varying radius creates natural-looking passages

---

## 5. Ore Distribution (1.18+)

All ores use **triangular distribution** -- more concentrated at the peak Y level, tapering off toward edges.

### Ore Table

| Ore | Y Range | Peak Level | Avg Blocks/Chunk | Vein Size | Notes |
|-----|---------|------------|------------------|-----------|-------|
| Coal | 0 to 320 | Y=96 | ~62 | up to 17 | Not below Y=0 |
| Iron | -64 to 320 | Y=16, Y=232 | ~53.5 | up to 9 | Two distributions; mountains have extra |
| Copper | -16 to 112 | Y=48 | varies | up to 10 | Larger veins in dripstone caves |
| Gold | -64 to 32 | Y=-16 | varies | up to 9 | Extra in Badlands (Y=32-256) |
| Lapis Lazuli | -64 to 64 | Y=0 | varies | up to 7 | Two distributions overlap at Y=-1 |
| Redstone | -64 to 15 | Y=-59 | varies | up to 8 | Concentrated near bedrock |
| Diamond | -64 to 16 | Y=-59 | ~10.4 | 1-12 | Multiple batches; air exposure reduces |
| Emerald | -16 to 320 | Y=236 | varies | 1 (single) | Only in mountain biomes |

### Diamond Generation Details (1.18+)
- Batch 1: 7 features/chunk, 1-4 ores each, Y=-63 to Y=14, triangular toward bottom
- Batch 2: 1 feature per 9 chunks, 1-12 ores, Y=-63 to Y=14
- Batch 3: 4 features/chunk, 1-8 ores, buried (reduced by air exposure)

### Large Ore Veins
- **Iron veins**: Generate below Y=-8 down to Y=-60, contain iron ore + raw iron blocks, can contain 2000+ ore
- **Copper veins**: Generate Y=0 to Y=50, contain copper ore + raw copper blocks

### Deepslate
- Deepslate and deepslate ore variants only generate below Y=8
- Gradual transition from stone to deepslate between Y=0 and Y=8

---

## 6. Tree Generation

### Tree Types and Space Requirements

| Tree Type | Min Height Above | Clearance Area | Special Rules |
|-----------|-----------------|----------------|---------------|
| Oak | 5 blocks | 3x3 column | Ignores own logs |
| Birch | 6 blocks | 3x3 column | Ignores own logs |
| Spruce | 6 blocks | 5x5 column | Needs 2 blocks between trees |
| Jungle | 5 blocks | 3x3 column | Ignores own logs |
| Acacia | 6 blocks | 5x5 column | -- |
| Dark Oak | 7 blocks | 6x6 column | Must be 2x2 saplings |
| Giant Spruce | 14 blocks | 6x6 column | Must be 2x2 saplings, 4x4 clear at base |
| Giant Jungle | 11 blocks | 6x6 column | Must be 2x2 saplings, 4x4 clear at base |

### Planting Requirements
- Saplings grow on any dirt variant (except dirt paths) or moss blocks
- Requires light level >= 8 at the sapling block
- Growth has a random chance each random tick

### Generation in World
- Trees are placed as "features" during world generation
- Each biome specifies tree types and density
- Trees check space requirements before placing
- Trunk is placed first, then leaves, then any decorations (vines, cocoa, etc.)

---

## 7. Water & Lava Mechanics

### Source Blocks vs Flowing Blocks
- **Source block**: level 0 (full), permanent unless removed
- **Flowing block**: levels 1-7 (increasing = less water)
- Level increases by 1 for each block of horizontal distance from source
- When flowing over an edge (downward), level resets to falling (renders as full column)

### Flow Distance
| Fluid | Overworld/End | Nether |
|-------|--------------|--------|
| Water | 7 blocks horizontal | 7 blocks |
| Lava | 3 blocks horizontal | 7 blocks |

### Flow Speed (ticks per block spread)
| Fluid | Overworld/End | Nether |
|-------|--------------|--------|
| Water | 5 ticks (4 blocks/sec) | 5 ticks |
| Lava | 30 ticks (0.67 blocks/sec) | 10 ticks (2 blocks/sec) |

### Flow Algorithm
1. If block below is air/replaceable, flow straight down (level resets)
2. If block below is solid, spread horizontally to all open sides
3. For horizontal spread, weight is assigned to each direction:
   - Default weight: 1000
   - For each direction, search up to 4 blocks for a downward path
   - If found, set weight to the path distance
   - Water flows toward directions with **lowest weight** (shortest path to falling)
4. New flowing blocks are added to a spread list, processed on fluid ticks

### Source Block Creation
- **Water**: Two adjacent water source blocks + a block that liquids can flow into + solid ground beneath = new source block
- **Lava**: Source block creation is disabled by default

### Fluid Interactions
- Flowing lava contacts water block -> **cobblestone**
- Lava flowing into water from above -> **stone**
- Water contacts lava source block (top/sides) -> **obsidian**

### Waterlogging
- Many non-full blocks can be waterlogged (stairs, slabs, fences, etc.)
- Full blocks (leaves, copper grates) stop water flow in Java Edition
- Waterlogged stairs block flow from rear and bottom surfaces

---

## 8. Player Physics

### Movement Speeds

| Action | Speed (m/s) | Speed (blocks/tick) |
|--------|-------------|---------------------|
| Walking | 4.317 | ~0.216 |
| Sprinting | 5.612 | ~0.281 |
| Sneaking | ~1.295 | ~0.065 |
| Sprint-jumping | 7.127 | ~0.356 |
| Swimming | ~2.2 | ~0.11 |
| Flying (creative) | ~10.89 | ~0.545 |

### Horizontal Movement Formula (per tick)
Three steps each tick:
1. **Acceleration**: added to velocity
2. **Position update**: position += velocity
3. **Drag**: velocity *= friction

**Ground velocity formula:**
```
V = V_prev * S_prev * 0.91 + 0.1 * M * E * (0.6 / S)^3
```
Where:
- `V_prev` = previous tick velocity
- `S` = surface slipperiness (see below)
- `0.91` = base drag multiplier
- `M` = movement multiplier (walk=1.0, sprint=1.3, sneak=0.3, stop=0.0)
- `E` = status effect multiplier (Speed I = 1.2, Speed II = 1.4, etc.)

**Airborne velocity formula:**
```
V = V_prev * 0.91 + 0.02 * M
```
(Much less control in the air)

### Surface Slipperiness
| Surface | Slipperiness |
|---------|-------------|
| Default (most blocks) | 0.6 |
| Slime blocks | 0.8 |
| Ice / Packed Ice | 0.98 |
| Blue Ice | 0.989 |
| Airborne | 1.0 |

### Vertical Physics
- **Gravity**: 0.08 blocks/tick^2 (subtracted each tick)
- **Drag**: 0.98 (multiplied each tick after gravity)
- **Initial jump velocity**: 0.42 blocks/tick
- **Jump Boost**: adds 0.1 per level to initial velocity
- **Terminal velocity**: ~3.92 blocks/tick (78.4 m/s)

**Per-tick vertical update:**
```
velocity = (velocity - 0.08) * 0.98
position += velocity
```

### Jump Heights
| Condition | Max Height (blocks) |
|-----------|-------------------|
| Normal jump | 1.2522 |
| Jump Boost I | 1.8361 |
| Jump Boost II | 2.5168 |

### Sprint-Jump Bonus
- Sprint-jumping adds +0.2 to horizontal velocity in the facing direction
- Costs 4x the hunger of a normal jump

### Momentum Threshold
- If velocity < 0.005 (0.003 in 1.9+), velocity is set to 0
- This prevents infinite sliding

### Player Dimensions
- Standing: 0.6 wide x 1.8 tall
- Sneaking: 0.6 wide x 1.5 tall
- Swimming/crawling: 0.6 wide x 0.6 tall
- Eye height: 1.62 (standing), 1.27 (sneaking)

---

## 9. Block Breaking

### Formula
```
Breaking time (seconds) = hardness * multiplier / speed
```

Where:
- `multiplier` = 1.5 if correct tool, 5.0 if wrong tool or no tool
- `speed` = tool speed * enchantment bonus * effect bonus

### Tool Speed Multipliers

| Tool Material | Speed |
|--------------|-------|
| None (hand) | 1 |
| Wood | 2 |
| Stone | 4 |
| Iron | 6 |
| Diamond | 8 |
| Netherite | 9 |
| Gold | 12 |

### Enchantment & Effect Bonuses
- **Efficiency**: adds (level^2 + 1) to tool speed
  - Efficiency I: +2, II: +5, III: +10, IV: +17, V: +26
- **Haste**: multiplies speed by (1 + 0.2 * level)
  - Haste I: x1.2, Haste II: x1.4
- **Mining Fatigue**: multiplies speed by 0.3^min(level, 4)
  - Level I: x0.3, Level II: x0.09, Level III: x0.0027

### Penalties
- **Underwater** (no Aqua Affinity): 5x slower
- **Not on ground**: additional 5x slower
- Both penalties stack (25x slower)

### Common Block Hardness Values

| Block | Hardness | Best Tool |
|-------|----------|-----------|
| Dirt/Grass/Sand | 0.5-0.6 | Shovel |
| Wood (logs/planks) | 2.0 | Axe |
| Stone | 1.5 | Pickaxe |
| Cobblestone | 2.0 | Pickaxe |
| Iron Ore | 3.0 | Stone+ Pickaxe |
| Diamond Ore | 3.0 | Iron+ Pickaxe |
| Obsidian | 50.0 | Diamond+ Pickaxe |
| Bedrock | -1.0 | Unbreakable |
| Netherite Block | 50.0 | Diamond+ Pickaxe |
| Leaves | 0.2 | Shears/Hoe |
| Glass | 0.3 | Any (no drop) |

### Breaking Animation
- 10 stages (0-9) displayed as progressive cracks
- Stage updates at equal intervals based on total break time
- If tool/position changes, progress resets

### Harvest Requirements
- Some blocks require minimum tool tier to drop items:
  - Stone/ores: require pickaxe
  - Iron/Diamond/Gold ore: require stone+ pickaxe
  - Obsidian: requires diamond+ pickaxe
  - Wood: any tool works but axe is fastest

### Instant Mining
- If damage-per-tick >= hardness * 30 on the first tick, block breaks instantly
- 6-tick delay (0.3 seconds) between breaking consecutive blocks (unless instant)

---

## 10. Day/Night Cycle

### Timing

| Phase | Start Tick | End Tick | Real Duration |
|-------|-----------|---------|---------------|
| Day | 0 (6:00 AM) | 12,000 | 10 minutes |
| Sunset | 12,000 (6:00 PM) | 13,000 | 50 seconds |
| Night | 13,000 (7:00 PM) | 23,000 | 8 min 20 sec |
| Sunrise | 23,000 (5:00 AM) | 24,000 | 50 seconds |

### Key Time Points
- **Noon**: 6,000 ticks (12:00 PM)
- **Midnight**: 18,000 ticks (12:00 AM)
- **Full cycle**: 24,000 ticks = 20 real minutes
- **1 tick** = 1/20 second real time
- **1 Minecraft hour** = 1,000 ticks = 50 real seconds
- **Time scale**: 72x real time

### Tick System
- Game runs at 20 ticks per second (TPS)
- Each tick: entity updates, block updates, redstone, fluid flow, etc.
- **Random tick**: each game tick, 3 random blocks per chunk section are ticked (crop growth, leaf decay, etc.)

### Light Levels (0-15)

#### Block Light
- Emitted by light-emitting blocks (torch=14, glowstone=15, redstone torch=7, etc.)
- **Propagation**: flood fill algorithm, decreases by 1 per block of taxicab distance
- Creates diamond-shaped illumination pattern
- Each block has an opacity that reduces light passing through

#### Sky Light
- Level 15 for blocks with direct sky access
- Spreads downward at level 15 through transparent blocks
- Horizontal/upward spread decreases by 1 per block
- **Internal sky light** is NOT reduced at night
- Instead, an "internal sky light subtracted" value changes based on time/weather:
  - Clear noon: 0 (full brightness)
  - Clear midnight: 11 (effective sky light = max 4)
  - Rain: +3 to subtracted value
  - Thunder: +5

#### Light-Filtering Blocks
- Water, ice, leaves, cobweb: reduce sky light by 1 level (Java)
- Fully opaque blocks: block all light
- Some blocks (pistons, slabs, stairs) have directional opacity

#### Effective Light Level
```
effective_light = max(block_light, sky_light - sky_subtracted)
```

---

## 11. Mob Spawning

### Mob Caps (Java Edition, per player)

| Category | Cap | Spawn Cycle |
|----------|-----|-------------|
| Monster (hostile) | 70 | Every tick |
| Creature (passive) | 10 | Every 400 ticks (20 sec) |
| Ambient (bats) | 15 | Every tick |
| Axolotls | 5 | Every tick |
| Underground Water Creature | 5 | Every tick |
| Water Creature | 5 | Every tick |
| Water Ambient (fish) | 20 | Every tick |

### Light Level Requirements
- **Hostile mobs** (Overworld): block light = 0 AND internal sky light <= 7
- **Passive mobs**: block light >= 9 (Java), >= 7 (Bedrock)
- **Bats**: light level <= 4

### Distance Rules
- **Minimum spawn distance**: 24 blocks (spherical) from any player
- **Maximum spawn distance**: 128 blocks (spherical) from nearest player
- **Random despawn**: mobs > 32 blocks from any player have random chance to despawn each tick
- **Instant despawn**: mobs > 128 blocks from nearest player despawn immediately
- Passive mobs (animals) do NOT despawn

### Spawning Surface Rules
- Hostile mobs: spawn on opaque, full blocks with no obstruction above
- Passive mobs: must spawn on **grass blocks** specifically
- Mobs need 2 blocks of space above (1 for short mobs)
- No spawning on transparent blocks, slabs (bottom half), stairs, etc.

### Bedrock Edition Differences
- Global cap: 200 regardless of difficulty
- Spawning occurs within 24-44 block spherical shell around player

---

## 12. Crafting System

### Crafting Grids
- **Inventory grid**: 2x2 (4 slots) -- limited recipes only
- **Crafting Table grid**: 3x3 (9 slots) -- all recipes

### Recipe Types
1. **Shaped recipes**: ingredients must be in correct relative positions
   - Can be shifted up/down/left/right within the grid
   - Can be flipped horizontally (mirrored)
   - Cannot be flipped vertically
2. **Shapeless recipes**: ingredients can be in any position
   - Examples: mushroom stew, book and quill, fermented spider eye
3. **Fixed recipes**: cannot be moved or mirrored (rare)

### Recipe Output
- Crafting produces a fixed output amount per craft
- Shift-clicking crafts maximum possible from available materials

### Smelting/Furnace
- Separate from crafting grid
- 1 input slot + 1 fuel slot -> 1 output
- Takes time (10 seconds per item default)
- Provides XP on collection

---

## 13. Inventory

### Slot Layout
| Section | Slots | Notes |
|---------|-------|-------|
| Hotbar | 9 | Bottom row, selected with 1-9 keys |
| Main inventory | 27 | 3 rows above hotbar |
| Armor (head) | 1 | Helmet slot |
| Armor (chest) | 1 | Chestplate slot |
| Armor (legs) | 1 | Leggings slot |
| Armor (feet) | 1 | Boots slot |
| Offhand | 1 | Shield/map/torch, F key |
| **Total persistent** | **41** | |
| Crafting (2x2) | 4 | Temporary, items drop when closed |
| Crafting output | 1 | Read-only |
| Cursor | 1 | Temporary, item being moved |

### Stack Sizes
- **Default**: 64 items per stack
- **16-stack items**: snowballs, ender pearls, signs, banners, eggs, buckets (empty stack, filled don't)
- **Unstackable (1)**: tools, weapons, armor, potions, boats, minecarts, saddles, beds

### Item Durability
- Tools and armor have durability (varies by material)
- Each use decreases durability by 1 (some actions cost more)
- Unbreaking enchantment gives chance to not consume durability
- At 0 durability, item breaks

---

## Key Implementation Constants Summary

```
CHUNK_SIZE_X = 16
CHUNK_SIZE_Z = 16
CHUNK_HEIGHT = 384  (Y=-64 to Y=319)
SECTION_SIZE = 16   (16x16x16)
MIN_Y = -64
MAX_Y = 319
SEA_LEVEL = 63

TICKS_PER_SECOND = 20
TICKS_PER_DAY = 24000
DAY_LENGTH_SECONDS = 1200  (20 minutes)

GRAVITY = 0.08            (blocks/tick^2)
DRAG_VERTICAL = 0.98
DRAG_HORIZONTAL = 0.91
JUMP_VELOCITY = 0.42      (blocks/tick)
WALK_SPEED = 4.317         (m/s)
SPRINT_MULTIPLIER = 1.3
SNEAK_MULTIPLIER = 0.3
DEFAULT_SLIPPERINESS = 0.6
TERMINAL_VELOCITY = 3.92   (blocks/tick)

PLAYER_WIDTH = 0.6
PLAYER_HEIGHT = 1.8
PLAYER_EYE_HEIGHT = 1.62

LIGHT_MAX = 15
LIGHT_MIN = 0

SPAWN_DISTANCE_MIN = 24
SPAWN_DISTANCE_MAX = 128
DESPAWN_DISTANCE_RANDOM = 32
DESPAWN_DISTANCE_INSTANT = 128

HOSTILE_MOB_CAP = 70
PASSIVE_MOB_CAP = 10

DEFAULT_STACK_SIZE = 64
INVENTORY_MAIN_SLOTS = 27
HOTBAR_SLOTS = 9
ARMOR_SLOTS = 4
OFFHAND_SLOTS = 1
```
